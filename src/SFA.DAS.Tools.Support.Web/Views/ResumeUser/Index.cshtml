@{
    ViewData["Title"] = "Support Portal";
    @model ResumeUsersViewModel
    @using SFA.DAS.Tools.Support.Web.Configuration
}

<partial name="User/_Styles"></partial>

@if (Model != null && Model.HasError)
{
  <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-xl">
                Error resuming user account(s).
            </h1>
            <p class="govuk-body">
                Please return to the <a asp-action="@RouteNames.EmployerAccountsData_SearchUsers">search</a> to try again.
            </p>
        </div>
    </div>
}
else
{    
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <h1 class="govuk-heading-l">
                Resume users
            </h1>
            <partial name="Apprenticeship/_FormHelp" />            
        </div>
        <div asp-validation-summary="ModelOnly" id="searchFormValidationSummary" class="govuk-error-message"></div>
    </div>
    <div>
        <form id="usersForm" method="POST" asp-route="@RouteNames.ResumeUsersConfirmation">
             <table id="usersResultsTable"
               data-toggle="table"
               data-pagination="true"
               data-page-list="[10, 25, 50]"
               data-search="true"
               data-click-to-select="true"
               data-sortable="true"
               data-side-pagination="client"
               data-id-field="UserRef"
               data-checkbox-header="true"
               data-select-item-name="UserRef"
               data-maintain-meta-data="true"
               style="table-layout: fixed">
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col"
                            class="col-wrap"
                            data-field="userRef"
                            data-visible="false">
                        </th>
                        <th scope="col"
                            class="col-wrap"
                            data-sortable="true"
                            data-field="name"
                            data-width="10"
                            data-width-unit="%">
                            Name
                        </th>
                        <th scope="col"
                            class="col-wrap"
                            data-sortable="true"
                            data-field="email"
                            data-width="10"
                            data-width-unit="%">
                            Email
                        </th>
                        <th scope="col"
                            class="col-wrap"
                            data-sortable="true"
                            data-field="role"
                            data-width="10"
                            data-width-unit="%">
                            Role
                        </th>     
                        <th scope="col"
                            class="col-wrap"
                            data-sortable="true"                            
                            data-width="10"
                            data-width-unit="%">
                            State
                        </th>                
                    </tr>
                </thead>
                <tbody>
                    @foreach(var user in Model.Users)
                    {
                    <tr>
                        <td>@user.UserRef</td>
                        <td>
                            @user.Name
                        </td>
                        <td>
                            @user.Email
                        </td>
                        <td>
                            @user.Role
                        </td>
                         @if (user.ApiSubmissionStatus == SubmissionStatus.Errored)
                        {
                        <td class="govuk-input--error">
                            @user.ApiErrorMessage
                        </td>
                        }
                        else if(user.ApiSubmissionStatus == SubmissionStatus.Successful)
                        {
                        <td class="govuk-panel--confirmation">
                            Submitted successfully
                        </td>
                        }
                        else
                        {
                        <td>
                            Pending
                        </td>
                        }
                    </tr>
                    }
                </tbody>
            </table>
            <br />
            @Html.HiddenFor(s => s.HashedAccountId)
            @Html.HiddenFor(s => s.InternalAccountId)
            <input type="hidden" id="userData" name="UserData" />
            <button asp-route="@RouteNames.CancelResumeUsers" class="govuk-button" data-module="govuk-button" id="cancelButton">Back</button>
            @if (!Model.UsersResumeCompleted)
            {
                <button class="govuk-button" data-module="govuk-button" id="okButton">Re-instate user(s)</button>
            }

        </form>
    </div>
}

@section scripts {
   <partial name="User/_Scripts"></partial>
}